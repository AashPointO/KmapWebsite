<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="style.css">
		<script src="script.js">
		</script>
	</head>
	<body>
		<div id="genBody">
			<div>
				<h1> K-Map Generator with Multiple Outputs </h1>
				<div id="input-text-fields" class="standard-border"> 
						numBits:  <input type="number" id="nBits"
							       value=2 min=2 max=4 maxLength = 1
							       onfocusout="ensureValidBounds('nBits', 2, 4)">
						<br>
						<br>
						numOut:  <input type="number" id="nOutputs"
								 value=1 min=1 max=8 maxLength = 1
								 onfocusout="ensureValidBounds('nOutputs', 1, 8)">
				</div>
				<br>

				<table id="truth-table" class="standard-border">
					<!-- Table is modified entirely onto the truth-table -->
				</table>

				<br>
				<br>
				<br>
				<hr>
				<br>

				<div class="flex-container" id="outputs-container">
				</div>
			</div>
		</div>
		<script>
			let desiredNumBits = parseInt(document.getElementById("nBits").value);
			let desiredNumOutputs = parseInt(document.getElementById("nOutputs").value);

			let tableRef = initTruthTable(desiredNumBits, desiredNumOutputs);
			let outputsContainer = initOutputContainer(desiredNumBits, desiredNumOutputs, tableRef);

			document.getElementById("nBits").addEventListener("focusout", nBitsTextFieldFocusOut);
			document.getElementById("nOutputs").addEventListener("focusout", nOutputsTextFieldFocusOut);
			
			function initTruthTable(desiredNumBits, desiredNumOutputs) {
				var tableRef = document.getElementById("truth-table");

				tableRef = resizeRows(tableRef, desiredNumBits);

				tableRef = resizeIndexCols(tableRef);

				tableRef = resizeBitCols(tableRef, desiredNumBits);
				tableRef = resizeOutputCols(tableRef, desiredNumOutputs);
				
				tableRef = assignBitsToTable(tableRef);
				tableRef = addOutputColTextFieldsToTable(tableRef);
				
				tableRef.rows[0] = addHeaderLabels(tableRef.rows[0]);

				return tableRef;
			}

			function initOutputContainer(numBits, numOutputs, tableRef) {
				var outputsContainer = document.getElementById("outputs-container");
				outputsContainer.innerHTML = ""; // Deletes all contents of outputContainer

				for (var i = 0; i < numOutputs; i++) { // For Each Set of Outputs
					let singleOutputContainer = document.createElement("div");
					singleOutputContainer.classList.add("flex-container-single-output");

					let kMapTable = generateKMapTableNode(numBits, i);
					singleOutputContainer.appendChild(kMapTable);


					outputsContainer.appendChild(singleOutputContainer);
				}


				for (var i = 0; i < outputsContainer.childNodes.length; i++) {
					let kMapTable = outputsContainer.childNodes[i].firstElementChild;
					
					let implicantListSOP = getImplicantsFromKMap(kMapTable, desiredNumBits, "1");
					let implicantListPOS = getImplicantsFromKMap(kMapTable, desiredNumBits, "0");
					
					let variablesListSOP = returnPrimeAdjacencyList(implicantListSOP, desiredNumBits)
					let variablesListPOS = returnPrimeAdjacencyList(implicantListPOS, desiredNumBits)
					debugger;
					
					let textNodeSOP = generateSOPDivNode(variablesListSOP);
					let textNodePOS = generatePOSDivNode(variablesListPOS);

					outputsContainer.childNodes[i].appendChild(textNodeSOP);
					outputsContainer.childNodes[i].appendChild(textNodePOS);
				}

				
				return outputsContainer;
			}

			function nBitsTextFieldFocusOut() {
				var tableRef = document.getElementById("truth-table");
				let desiredNumBits = parseInt(document.getElementById("nBits").value);
				let desiredNumOutputs = parseInt(document.getElementById("nOutputs").value);
				let outputsContainer = document.getElementById("outputs-container");
				outputsContainer.innerHTML = ""; // Deletes all contents of outputContainer

				tableRef = resizeRows(tableRef, desiredNumBits);
				tableRef = resizeIndexCols(tableRef);

				tableRef = resizeBitCols(tableRef, desiredNumBits);
				tableRef = resizeOutputCols(tableRef, desiredNumOutputs);

				tableRef = assignBitsToTable(tableRef);
				tableRef = addOutputColTextFieldsToTable(tableRef);

				tableRef.rows[0] = addHeaderLabels(tableRef.rows[0]);
				
				// OUTPUT HANDLING::
				for (var i = 0; i < desiredNumOutputs; i++) { // For Each Set of Outputs
					let singleOutputContainer = document.createElement("div");
					singleOutputContainer.classList.add("flex-container-single-output");
					
					let kMapTable = generateKMapTableNode(desiredNumBits, i);
					singleOutputContainer.appendChild(kMapTable);

					outputsContainer.appendChild(singleOutputContainer);
				}
				
				assignIndividualValuesToKMaps(outputsContainer, tableRef, desiredNumOutputs);
				for (var i = 0; i < outputsContainer.childNodes.length; i++) {
					let kMapTable = outputsContainer.childNodes[i].firstElementChild;

					let implicantListSOP = getImplicantsFromKMap(kMapTable, desiredNumBits, "1");
					let implicantListPOS = getImplicantsFromKMap(kMapTable, desiredNumBits, "0");
					
					let variablesListSOP = returnPrimeAdjacencyList(implicantListSOP, desiredNumBits)
					let variablesListPOS = returnPrimeAdjacencyList(implicantListPOS, desiredNumBits)
					debugger;
					
					let textNodeSOP = generateSOPDivNode(variablesListSOP);
					let textNodePOS = generatePOSDivNode(variablesListPOS);
					outputsContainer.childNodes[i].appendChild(textNodeSOP);
					outputsContainer.childNodes[i].appendChild(textNodePOS);
				
				}
				
			}
			
			function nOutputsTextFieldFocusOut() {
				var tableRef = document.getElementById("truth-table");
				let desiredNumBits = parseInt(document.getElementById("nBits").value);
				let desiredNumOutputs = parseInt(document.getElementById("nOutputs").value);
				let outputsContainer = document.getElementById("outputs-container");
				outputsContainer.innerHTML = ""; // Deletes all contents of outputContainer

				tableRef = resizeOutputCols(tableRef, desiredNumOutputs);
				tableRef.rows[0] = addHeaderLabels(tableRef.rows[0]);
				tableRef = addOutputColTextFieldsToTable(tableRef);
			

				// OUTPUT HANDLING::
				for (var i = 0; i < desiredNumOutputs; i++) { // For Each Set of Outputs
					let singleOutputContainer = document.createElement("div");
					singleOutputContainer.classList.add("flex-container-single-output");
					
					let kMapTable = generateKMapTableNode(desiredNumBits, i);
					singleOutputContainer.appendChild(kMapTable);

					outputsContainer.appendChild(singleOutputContainer);
				}

				assignIndividualValuesToKMaps(outputsContainer, tableRef, desiredNumOutputs);
				for (var i = 0; i < outputsContainer.childNodes.length; i++) {
					let kMapTable = outputsContainer.childNodes[i].firstElementChild;
					
					let implicantListSOP = getImplicantsFromKMap(kMapTable, desiredNumBits, "1");
					let implicantListPOS = getImplicantsFromKMap(kMapTable, desiredNumBits, "0");
					
					let variablesListSOP = returnPrimeAdjacencyList(implicantListSOP, desiredNumBits)
					let variablesListPOS = returnPrimeAdjacencyList(implicantListPOS, desiredNumBits)
					debugger;
					
					let textNodeSOP = generateSOPDivNode(variablesListSOP);
					let textNodePOS = generatePOSDivNode(variablesListPOS);
					outputsContainer.childNodes[i].appendChild(textNodeSOP);
					outputsContainer.childNodes[i].appendChild(textNodePOS);
				
				}
				

			}

		</script>
	</body>
</html>
